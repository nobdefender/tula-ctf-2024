from PIL import Image
from matplotlib.pyplot import bar

code128_chars = {
"0":	"11011001100",
"1":	"11001101100",
"2":	"11001100110",
"3":	"10010011000",
"4":	"10010001100",
"5":	"10001001100",
"6":	"10011001000",
"7":	"10011000100",
"8":	"10001100100",
"9":	"11001001000",
"10":	"11001000100",
"11":	"11000100100",
"12":	"10110011100",
"13":	"10011011100",
"14":	"10011001110",
"15":	"10111001100",
"16":	"10011101100",
"17":	"10011100110",
"18":	"11001110010",
"19":	"11001011100",
"20":	"11001001110",
"21":	"11011100100",
"22":	"11001110100",
"23":	"11101101110",
"24":	"11101001100",
"25":	"11100101100",
"26":	"11100100110",
"27":	"11101100100",
"28":	"11100110100",
"29":	"11100110010",
"30":	"11011011000",
"31":	"11011000110",
"32":	"11000110110",
"33":	"10100011000",
"34":	"10001011000",
"35":	"10001000110",
"36":	"10110001000",
"37":	"10001101000",
"38":	"10001100010",
"39":	"11010001000",
"40":	"11000101000",
"41":	"11000100010",
"42":	"10110111000",
"43":	"10110001110",
"44":	"10001101110",
"45":	"10111011000",
"46":	"10111000110",
"47":	"10001110110",
"48":	"11101110110",
"49":	"11010001110",
"50":	"11000101110",
"51":	"11011101000",
"52":	"11011100010",
"53":	"11011101110",
"54":	"11101011000",
"55":	"11101000110",
"56":	"11100010110",
"57":	"11101101000",
"58":	"11101100010",
"59":	"11100011010",
"60":	"11101111010",
"61":	"11001000010",
"62":	"11110001010",
"63":	"10100110000",
"64":	"10100001100",
"65":	"10010110000",
"66":	"10010000110",
"67":	"10000101100",
"68":	"10000100110",
"69":	"10110010000",
"70":	"10110000100",
"71":	"10011010000",
"72":	"10011000010",
"73":	"10000110100",
"74":	"10000110010",
"75":	"11000010010",
"76":	"11001010000",
"77":	"11110111010",
"78":	"11000010100",
"79":	"10001111010",
"80":	"10100111100",
"81":	"10010111100",
"82":	"10010011110",
"83":	"10111100100",
"84":	"10011110100",
"85":	"10011110010",
"86":	"11110100100",
"87":	"11110010100",
"88":	"11110010010",
"89":	"11011011110",
"90":	"11011110110",
"91":	"11110110110",
"92":	"10101111000",
"93":	"10100011110",
"94":	"10001011110",
"95":	"10111101000",
"96":	"10111100010",
"97":	"11110101000",
"98":	"11110100010",
"99":	"10111011110",
"100":	"10111101110",
"101":	"11101011110",
"102":	"11110101110",
"103":	"11010000100",
"104":	"11010010000",
"105":	"11010011100"}


# flag = "BEZ_DVAATSATI_PYAT_MAMA_KUPILA_JAMKI"
# 7 parts
# flag = "BEZ_D"+"VAATSAT"+"I_PYAT"+"_MAM"+"A_KUP"+"ILA_J"+"AMKI"
flag = ["BEZ_D", "VAATSAT", "I_PYAT", "_MAM", "A_KUP", "ILA_J", "AMKI"]
jamka_x = [267, 767, 300, 914, 594, 27, 1078]
jamka_y = [130, 787, 472, 259, 132, 645, 627]


def calc_crc(flagg):
    barcode_crc = 0
    for i in range(1,len(flagg)+1):
        barcode_crc += i * (ord(flagg[i-1])-32)
        # print(ord(flagg[i-1])-32)
    barcode_crc %= 103
    # print(barcode_crc)
    return code128_chars[str(barcode_crc)]


def make_barcode(flagg):
    barcode_white = "0000000000000000"
    barcode_start = "11010000100"
    barcode_data=""
    for i in range(len(flagg)):
        barcode_data += code128_chars[str(ord(flagg[i])-32)]
    # print(barcode_data)
    barcode_crc = calc_crc(flagg)
    # print(barcode_crc)
    barcode_stop = "1100011101011"
    barcode_white2 = "0000000000000000"

    barcode = (
        barcode_white
        + barcode_start
        + barcode_data
        + barcode_crc
        + barcode_stop
        + barcode_white2
    )
    # print(barcode)
    barcode=barcode.replace('1','2').replace('0','1').replace('2','0')
    # print(barcode)
    return barcode


image = Image.open("./jamki.png")
pixels = image.load()
width, height = image.size

# for x in range(width):
#     for y in range(height):
#         r,g,b=pixels[x,y]
#         r = 0
        
#         pixels[x,y]=(r,g,b)

for j in range(7):
    flag_part = make_barcode(flag[j])
    cnt = 0
    len_flag=len(flag_part)
    # print(len_flag)
    for y in range(jamka_y[j],jamka_y[j]+80):
        for x in range(jamka_x[j],jamka_x[j]+len_flag):
            r, g, b = pixels[x, y]
            if j == 0:
                r = r & (0xFF ^ 0b00000010)
                r += int(flag_part[cnt])<<1
            if j == 1:
                b = b & (0xFF ^ 0b00010000)
                b += int(flag_part[cnt])<<4
            if j == 2:
                g = g & (0xFF ^ 0b00000001)
                g += int(flag_part[cnt])
            if j == 3:
                r = r & (0xFF ^ 0b00000001)
                r += int(flag_part[cnt])
            if j == 4:
                b = b & (0xFF ^ 0b00000100)
                b += int(flag_part[cnt])<<2
            if j == 5:
                g = g & (0xFF ^ 0b00000010)
                g += int(flag_part[cnt])<<1
            if j == 6:
                r = r & (0xFF ^ 0b00001000)
                r += int(flag_part[cnt])<<3
            cnt+=1
            pixels[x, y] = (r, g, b)
            if cnt>=len_flag:
                break
        cnt = 0

image.save("./jamki_.png")

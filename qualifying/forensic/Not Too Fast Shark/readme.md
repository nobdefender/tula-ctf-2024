# Not Too Fast Shark

Добрый день, агент!
У нас для тебя дело. Удалось поймать того самого Mr.Robot и завладеть его компьютером.
Нужна помощь в раскрытии данных на диске.
В ходе наших исследований мы установили, что для шифрования применяется AES-256+SHA-256.
Так же была восстановлена часть пароля из оперативной памяти
методом криозамарозки ```sT??xAp3```, где ? - неизвестные символы.
Наши компьютеры слишком медленные, поручаем вам раскрыть данные на диске.

Формат флага: ```TulaCTF{flag}```

```https://disk.yandex.ru/d/G2Am4Z11xFvDsA``` - Пароль от яндекс диска ```tulactf2024```

Запасная ссылка с папкой самой виртуалки: ```https://disk.yandex.ru/d/Hek80kb6Ov3umA```. Пароль тот же.

# Flag

```TulaCTF{Mr_R0boT_5enDs_gReet1ngS_t0_fan5_wHo_l1ke_To_hiDe_f1lEs}```

# Решение

После скачивания получаем архив с виртуальной системой Windows 7 
под VirtualBox. Запускаем. Видим, что установлена VeraCrypt и на диске есть раздел, который просто так не открывается. Именно этот раздел зашифрован средствами VeraCrypt.

Лезем в гугл и выясняем, что нужный для взлома хеш лежит в первых 512 байтах раздела. Любым способ их извлекаем. Рекомендуется загрузиться в kali, заранее подключив диск с Windows, и с помощью команды ```dd``` извлекаем первые 512 байт раздела диска, который размером 5Гб. 

Из задания следует, что нужно подобрать пароль. Самое первое, что приходит на ум, hashcat.

По тексту задания собираем следующую команду

```.\hashcat.exe -d 1 -m 13751 vera.hash -a 3 -1 ?u?l?d sT?1?1xAp3 -o hackedhashes.pot ```

Получаем пароль: ```sTg6xAp3```

Открываем раздел, видим с десяток файлов rockyou, которые действительно являются словарями для подбора паролей. Правда 10й файл 0 байт.

Стоит проверить размер каждого файла. Подсказкой может стать время редактирования файла rockyou06.txt. Получаем, что файл отличается на 1 байт. Сравнив файлы, получаем, что там есть новый пароль ```autoline_rulit```. Но от чего он?

Теперь стоит проверить занимаемое место. Всего файлов 10, они занимают 1.3Гб, но на диске почему-то занято 1.7-1.8Гб. Откуда лишние 0.5Гб? В названии задания есть маленькая подсказка (NTFS). Лезем в гугл и находим, что есть возможность сокрытия данных в альтернативный поток в файловой системе NTFS. Скачиваем инструмент NSX, и с помощью неё ищем что-то скрытое в файлах.

В rockyou10.txt находим архив. В этом архиве картинка с котиком и архив с флагом. Вводим найденный пароль и получаем флаг.




